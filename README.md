##1. アプリケーション概要
このアプリケーションは、複数の自動車の経済性を比較するためのツールです。ユーザーは各車両の購入価格、燃費、燃料の種類、そして共通の月間走行距離や燃料価格を入力します。入力された情報に基づき、アプリケーションは経過年数ごとの総費用を計算し、グラフで視覚的に比較します。特に、2台の車の総費用が「交差する」期間（どちらの車がお得になるかが逆転する時点）を算出し、提示します。また、日本の公的統計データを提供するe-Stat APIと連携し、最新のガソリン価格を自動で取得・反映する機能を備えています。

##2. 動作原理
アプリケーションは、以下のステップで経済性比較を行います。

###2.1. 基本計算ロジック
入力値の取得: ユーザーが入力フィールドに入力した車両名、購入価格（万円）、燃費（Km/L）、燃料の種類、および共通のレギュラー/ハイオク/ディーゼル価格、月間走行距離（Km）を取得します。

燃料費の算出:

選択された燃料の種類（レギュラー、ハイオク、ディーゼル）に基づき、対応する燃料価格を適用します。

月間燃料費 = (月間走行距離 / 燃費) × 燃料価格

年間燃料費 = 月間燃料費 × 12

総費用の算出: 各車両の総費用は、初期の車両購入価格と経過年数に応じた年間燃料費の合計として算出されます。

総費用 = 車両購入価格 + (年間燃料費 × 経過年数)

###2.2. 交差点の計算とグラフ生成
2台の車の総費用が等しくなる経過年数を算出します。これは一次方程式の解として求められます。

グラフは、0年から特定の年数（交差点が存在する場合はその後の5年、存在しない場合は最低10年）までの総費用を折れ線グラフで表示し、費用推移を視覚的に捉えやすくします。

###2.3. e-Stat API連携の仕組み
「最新のガソリン価格を取得 (e-Stat API)」ボタンをクリックすると、以下のプロセスでガソリン価格が取得され、入力フィールドに反映されます。

API URLの直接指定: アプリケーションのJavaScriptコード内に、e-Stat APIの完全なリクエストURL（APIキー、統計データID、品目コード、地域、年月などのパラメータがすべて含まれたもの）が直接記述されています。

CORSプロキシ経由のリクエスト: ブラウザのCORS (Cross-Origin Resource Sharing) ポリシーによるブロックを回避するため、e-Stat APIへのリクエストは https://corsproxy.io/ という公開CORSプロキシサービスを経由して行われます。

API応答のカスタムパース: e-Stat APIの特定のデータ形式（CSVライクなテキスト形式）に対応するため、JavaScript内でカスタムのパースロジック (parseEStatCustomFormat 関数) を実装しています。これにより、APIから返された生のテキストデータから必要なガソリン価格、品目コード、時間コードなどを正確に抽出します。

ガソリン価格の算出: e-Statから取得されるのは主に「自動車ガソリン」の価格です。アプリでは、この価格をレギュラーガソリンの価格として採用し、そこから以下のルールでハイオクとディーゼル価格を算出します。

ハイオク = レギュラー価格 + 10円

ディーゼル = レギュラー価格 - 20円

入力フィールドへの反映: 取得・算出されたガソリン価格は、対応する入力フィールドに自動的に反映されます。また、データが取得された年月もステータスメッセージとして表示されます。

##3. 操作方法
###3.1. アプリ起動時の状態
アプリがロードされると、デフォルトの車両情報とガソリン価格で一度比較計算が実行され、初期のグラフが表示されます。

###3.2. 各入力フィールド
レギュラー (円/L), ハイオク (円/L), ディーゼル (円/L): ガソリンおよび軽油の単価を入力します。

一月の走行距離 (Km): 毎月の平均走行距離を入力します。

車両名: 各車両の任意の名前を入力します（例: 「私の車」「新しい車」）。

燃料の種類: 各車両が使用する燃料の種類を選択します。

車両購入価格 (万円): 各車両の初期購入費用を万円単位で入力します。

燃費 (Km/L): 各車両の燃費をKm/L単位で入力します。

###3.3. ボタンの機能
「最新のガソリン価格を取得 (e-Stat API)」ボタン:

クリックすると、コード内に設定されたe-Stat APIのURL（https://corsproxy.io/?https://api.e-stat.go.jp/...）にリクエストを送信します。

e-Statから取得したレギュラーガソリンの価格を基に、ハイオクとディーゼル価格を計算し、自動で入力フィールドに反映します。

取得状況やエラーメッセージがボタンの下に表示されます。

「比較する」ボタン:

現在の入力フィールドの値に基づいて、再度経済性比較の計算を実行し、結果表示とグラフを更新します。

「グラフをダウンロード (PNG)」ボタン:

現在表示されている比較グラフをPNG画像としてダウンロードします。

##4. 開発環境と技術スタック
プログラミング言語:

HTML: アプリケーションの骨格とコンテンツ

CSS (Tailwind CSS): スタイリングとレスポンシブデザイン

JavaScript: アプリケーションのロジック、計算、API通信、DOM操作

UI/CSS フレームワーク:

Tailwind CSS (CDN): 高速なUI構築のためのユーティリティファーストなCSSフレームワーク。開発の簡便性のためCDN版を使用しています（本番環境ではビルドツールでの導入が推奨されます）。

グラフ描画ライブラリ:

Chart.js (CDN): 柔軟でインタラクティブなグラフを生成するためのJavaScriptライブラリ。

API通信:

Fetch API: Webブラウザが提供する、ネットワークリソースを取得するためのモダンなAPI。

CORS回避ソリューション:

https://corsproxy.io/: クライアントサイドのCORSエラーを回避するために使用する、公開されているプロキシサービスです。開発・テスト目的での利用に適しています。

データ解析:

カスタムJavaScriptパースロジック: e-Stat APIの特定の応答形式（CSVライクなテキスト）をJavaScriptオブジェクトに変換するための独自の関数 (parseEStatCustomFormat) を実装しています。

##5. 注意事項
e-Stat API URLの正確性: アプリのJavaScriptコード内に直接記述されているe-Stat APIのURL（originalApiUrl変数）は、必ずご自身のAPIキーを含み、e-Statが提供する有効なURL形式であることを確認してください。URLの品目コード（cdCat02）がガソリンを指しているかも重要です。

CORSプロキシの利用: corsproxy.ioのような公開プロキシサービスは、開発・テスト用として便利ですが、本番環境での安定性やセキュリティは保証されません。 実際のサービスとして公開する場合は、ご自身でサーバーサイドプロキシを構築するなどの対策を検討してください。

e-Statデータのタイムラグ: e-Statの統計データは、公開までにタイムラグがあります。表示されるガソリン価格は、必ずしも「今日のリアルタイム価格」ではなく、数週間から数ヶ月前の平均価格である可能性が高いことをご留意ください。

ガソリン価格の算出: ハイオクやディーゼル価格は、e-Statから取得したレギュラーガソリン価格を基準に固定の差額（+10円、-20円）で計算されています。実際の市場価格の変動とは異なる場合があります。

エラーメッセージの確認: API関連で問題が発生した場合は、アプリ画面上のエラーメッセージに加え、ブラウザの開発者ツール（F12キーなどで開けます）のコンソールタブに出力される詳細なログをご確認ください。これにより、問題の特定に役立つ情報が得られます。
